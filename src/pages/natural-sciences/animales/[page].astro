---
import AnimalCard from '@components/AnimalCard.astro';
import Layout from '@layouts/Layout.astro';
import animales from '@data/animales-autoctonos.json';

export async function getStaticPaths() {
  const pageSize = 10;
  const pageCount = Math.ceil(animales.length / pageSize);
  return Array.from({ length: pageCount }, (_, i) => ({
    params: { page: String(i + 1) },
  }));
}

const pageNumber = parseInt(Astro.params.page, 10);
const pageSize = 10;
const start = (pageNumber - 1) * pageSize;
const end = start + pageSize;
const pageData = animales.slice(start, end);
const totalPages = Math.ceil(animales.length / pageSize);
---

<Layout title={`Animales aut√≥ctonos - P√°gina ${pageNumber}`}>
  
  
  <div class="title-animal">
    <h1>Animales aut√≥ctonos de Argentina</h1>

    <section class="grid">
      {pageData.map(animal => (
        <AnimalCard
          key={animal.id}
          nombre={animal.nombre}
          imagen={animal.imagen}
          texto={animal.texto}
        />
      ))}
    </section>
  </div>

  <nav>
    <div class="pagination">
      {pageNumber > 1 ? (
        <a href={`/natural-sciences/animales/${pageNumber - 1}`} class="prev">‚Üê Anterior</a>
      ) : (
        <span class="prev disabled">‚Üê Anterior</span>
      )}
  
      {pageNumber < totalPages ? (
        <a href={`/natural-sciences/animales/${pageNumber + 1}`} class="next">Siguiente ‚Üí</a>
      ) : (
        <span class="next disabled">Siguiente ‚Üí</span>
      )}
  
      <p>P√°gina {pageNumber} de {totalPages}</p> <!-- ‚úÖ Esto ahora aparecer√° abajo -->
    </div>
  </nav>

  <section class="memory-game">
    <h2 class="game__title">Juego de Memoria: Animales de Argentina üêæ</h2>
    <h3 class="game__subtitle">Encuentra los pares iguales üß†</h3>

    <div class="game__scores">
      <div id="score" class="game__score">Puntos: 0</div>
      <div id="matches" class="game__score">Aciertos: 0</div>
    </div>

    <div id="game-board" class="game__board"></div>
    <p id="feedback" class="game__feedback"></p>
    <button id="restart-btn" class="game__btn" onclick="startGame()">Reiniciar</button>
  </section>

  <style is:global>
    h1 {
      text-align: center;
      font-size: 2rem;
      color: #ffffff;
      margin-top: 0;
      padding-top: 2rem;

    }


    .title-animal {
       background-color: #59b659;

    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      padding: 2rem;
    }

    .pagination {
      background-color: #59b659;
      padding-top: 2rem;
      display: flex;
      flex-direction: column; /* üëà Clave para poner el <p> abajo */
      align-items: center;
      gap: 0.5rem;
}

.pagination a,
.pagination span {
  padding: 0.5rem 1rem;
  border-radius: 8px;
  background-color: #2ecc71;
  color: white;
  text-decoration: none;
}

.pagination .disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

.pagination p {
  margin: 0; /* ‚úÖ Evita el espacio blanco extra */
  font-size: 1rem;
  color: #333;
  padding-bottom: 2rem;
  padding-top: 2rem;
  font-weight: 400;
}


.memory-game {
      background-color: #ab2821;
      text-align: center;
      padding: 2rem;
    }

    .game__title {
      color: #fff;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .game__subtitle {
      color: #fff;
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }

    .game__scores {
      margin-bottom: 1rem;
      display: flex;
      justify-content: center;
      gap: 2rem;
      flex-wrap: wrap;
    }

    .game__score {
      color: #f1f1f1;
      font-weight: bold;
      font-size: 1rem;
    }

    .game__board {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 1rem;
      max-width: 900px;
      margin: 0 auto 1rem;
    }

    .card {
  width: 120px;
  height: 150px;
  perspective: 1000px;
  cursor: pointer;
  position: relative;
}

.card-front, .card-back {
  width: 100%;
  height: 100%;
  position: absolute;
  backface-visibility: hidden;
  border-radius: 12px;
}

.card-front {
  background-color: #ce8372; /* Color de la carta boca abajo */
}

.card-back {
  transform: rotateY(180deg);
}

.card.flipped .card-back {
  transform: rotateY(0);
}

.card.flipped .card-front {
  transform: rotateY(180deg);
}

.card img {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 12px 12px 0 0;
}

    @media (max-width: 600px) {
      .game__board {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
    }


    @media (max-width: 480px) {
      h1 {
        font-size: 1.5rem;
        padding: 0 1rem;
      }

      .pagination a,
      .pagination span {
        padding: 0.4rem 0.8rem;
        font-size: 0.9rem;
      }
    }
  </style>

  
<script is:inline>
  const animales = [
    { id: 1, nombre: "C√≥ndor Andino", imagen: "/img/img-naturales/condor-andino.webp" },
    { id: 2, nombre: "Yaguaret√©", imagen: "/img/img-naturales/yaguarete.webp" },
    { id: 3, nombre: "Carpincho", imagen: "/img/img-naturales/carpincho.webp" },
    { id: 4, nombre: "Guanaco", imagen: "/img/img-naturales/guanaco.webp" },
    { id: 5, nombre: "Puma", imagen: "/img/img-naturales/puma.webp" },
    { id: 6, nombre: "√ëand√∫", imagen: "/img/img-naturales/√±andu.webp" },
    { id: 7, nombre: "Tat√∫ Carreta", imagen: "/img/img-naturales/tatu-carreta.webp" },
    { id: 8, nombre: "Zorro Gris", imagen: "/img/img-naturales/zorro-gris.webp" },
    { id: 9, nombre: "Carancho", imagen: "/img/img-naturales/carancho.webp" },
    { id: 10, nombre: "Maras", imagen: "/img/img-naturales/maras.webp" },
    { id: 11, nombre: "Cisne de cuello negro", imagen: "/img/img-naturales/cisne.webp" },
    { id: 12, nombre: "Tuc√°n", imagen: "/img/img-naturales/tucan.webp" },
    { id: 13, nombre: "Delf√≠n del Plata", imagen: "/img/img-naturales/delfin-de-plata.webp" },
    { id: 14, nombre: "Yacar√©", imagen: "/img/img-naturales/Yacar√©.webp" },
    { id: 15, nombre: "√Åguila Mora", imagen: "/img/img-naturales/aguila-mora.webp" },
    { id: 16, nombre: "Carpintero Gigante", imagen: "/img/img-naturales/carpintero-gigante.webp" },
    { id: 17, nombre: "Monito del Monte", imagen: "/img/img-naturales/monito-del-monte.webp" },
    { id: 18, nombre: "Chinchilla", imagen: "/img/img-naturales/chinchilla.webp" },
    { id: 19, nombre: "Huemul", imagen: "/img/img-naturales/huemul.webp" },
    { id: 20, nombre: "Corzuela", imagen: "/img/img-naturales/corzuela.webp" }
  ];
  
  let cardsArray = [];
  let firstCard = null;
  let secondCard = null;
  let lockBoard = false;
  let score = 0;
  let matches = 0;
  
  const gameBoard = document.getElementById('game-board');
  const scoreEl = document.getElementById('score');
  const matchesEl = document.getElementById('matches');
  const feedbackEl = document.getElementById('feedback');
  
  function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
  }
  
  function startGame() {
    score = 0;
    matches = 0;
    firstCard = null;
    secondCard = null;
    lockBoard = false;
    feedbackEl.textContent = '';
    scoreEl.textContent = 'Puntos: 0';
    matchesEl.textContent = 'Aciertos: 0';
  
    // Duplicar y mezclar cartas
    cardsArray = shuffle([...animales, ...animales]);
  
    gameBoard.innerHTML = '';
    cardsArray.forEach((animal, index) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.name = animal.nombre;
      card.dataset.index = index;
      card.innerHTML = `
        <div class="card-front"></div>
        <div class="card-back">
          <img src="${animal.imagen}" alt="${animal.nombre}" />
        </div>
      `;
      card.addEventListener('click', flipCard);
      gameBoard.appendChild(card);
    });
  }
  
  function flipCard() {
    if (lockBoard) return;
    if (this === firstCard) return;
  
    this.classList.add('flipped');
  
    if (!firstCard) {
      firstCard = this;
      return;
    }
  
    secondCard = this;
    lockBoard = true;
  
    checkForMatch();
  }
  
  function checkForMatch() {
    const isMatch = firstCard.dataset.name === secondCard.dataset.name;
    if (isMatch) {
      firstCard.classList.add('matched');
      secondCard.classList.add('matched');
      score += 10;
      matches += 1;
      feedbackEl.textContent = '¬°Acertaste! ‚úÖ';
      resetBoard();
    } else {
      feedbackEl.textContent = 'Incorrecto ‚ùå';
      setTimeout(() => {
        firstCard.classList.remove('flipped');
        secondCard.classList.remove('flipped');
        resetBoard();
      }, 1000);
    }
    scoreEl.textContent = `Puntos: ${score}`;
    matchesEl.textContent = `Aciertos: ${matches}`;
  }
  
  function resetBoard() {
    [firstCard, secondCard] = [null, null];
    lockBoard = false;
  }
  
  window.onload = startGame;
  </script>


</Layout>
